/* =========================
   共通：カラーバー（降水・突風）
   ========================= */
.colorbar {
  width: 92%;
  height: 8px;
  margin: 0 auto;
  border-radius: 6px;
  border: 1px solid #bbb;
  display: flex;
  overflow: hidden;
  position: relative;
}

/* 既存のIDにも共通スタイルを適用 */
#precip-colorbar { width: 92%; height: 8px; margin: 0 auto; border-radius: 6px; border: 1px solid #bbb; display: flex; overflow: hidden; position: relative; }
#gust-colorbar   { width: 92%; height: 8px; margin: 6px auto 0 auto; border-radius: 6px; border: 1px solid #bbb; display: flex; overflow: hidden; position: relative; }

/* 共通ブロック */
.colorbar-block,
.precip-colorbar-block { /* 後方互換（JSが古いクラスでもOKに） */
  flex: 1 1 0;
  height: 100%;
}

/* 共通：ラベル行（子spanはabsoluteで配置） */
.colorbar-labels {
  font-size: 10px;
  color: #333;
  pointer-events: none;
  width: 92%;
  margin: 0 auto;
  line-height: 1.0;
  position: relative;
  height: 12px;
  /* 表示切替はJSで block/none にする */
}

.colorbar-block.transparent {
  background: repeating-conic-gradient(#ccc 0% 25%, transparent 0% 50%) 
              50% / 8px 8px;
}

/* 既存のIDにも共通ラベルスタイルを適用 */
#precip-colorbar-labels { font-size: 10px; color: #333; pointer-events: none; width: 92%; margin: 0 auto; line-height: 1.0; position: relative; height: 12px; }
#gust-colorbar-labels   { font-size: 10px; color: #333; pointer-events: none; width: 92%; margin: 0 auto; line-height: 1.0; position: relative; height: 12px; }

/* =========================
   レイアウト：左にサイドバー、右に地図
   ========================= */
html, body, #app { height: 100%; margin: 0; }
#app { display: flex; position: relative; }

/* サイドバー */
#sidebar {
  width: 260px;
  padding: 12px;
  background: #f6f6f6;
  border-right: 1px solid #ddd;
  overflow: auto;
  font-family: system-ui, sans-serif;
  position: relative;
  z-index: 2; /* 地図より前面 */
  transition: width .25s ease, padding .25s ease;
}

#sidebar.collapsed {
  width: 0;
  padding: 0;
  overflow: hidden;  /* 中身を隠す */
  border-right: none;
}

/* 入力UIアクセント色 */
input[type="checkbox"] { accent-color: #394e86; }
input[type="range"]    { accent-color: #394e86; }

/* トグルボタン（サイドバー端に沿わせる） */
#sidebar-toggle {
  position: absolute;
  top: 10px;
  left: 292px;     /* = サイドバー幅(260) + 余白 */
  z-index: 3;
  border: 1px solid #ccc;
  background: #fff;
  padding: 6px 8px;
  border-radius: 6px;
  cursor: pointer;
  user-select: none;
  transition: left .25s ease; /* サイドバーと一緒にスライド */
}

/* サイドバーが畳まれたときのボタン位置・表示 */
#sidebar.collapsed + #sidebar-toggle { left: 10px; }

#sidebar h3 { margin: 8px 0; font-size: 16px; }
#sidebar label { display: inline-flex; gap: 6px; align-items: center; margin: 4px 0; }

#sidebar-title {
  font-size: 18px;
  font-weight: bold;
  color: #ffffff;
  text-align: center;
  padding: 12px 8px;
  background: #394e86;
  border-bottom: 1px solid #ccc;
  margin: -12px -12px 12px -12px;
}

/* 横並び＋中央寄せの行 */
#sidebar .typhoon-row{
  display:flex;
  align-items:flex-end;     /* 下端揃え（好みで center でも） */
  gap:12px;
  flex-wrap:nowrap;         /* 幅が足りない時に折り返したいなら wrap に */
  margin:6px 0 12px;
}

/* 各フィールドの箱（縦積み：ラベル→セレクト） */
#sidebar .typhoon-row .field-year{
  display:flex; flex-direction:column;
  min-width: 2.5em;        /* お好みで調整 */
}
#sidebar .typhoon-row .field-number{
  display:flex; flex-direction:column;
  min-width: 8.5em;        /* お好みで調整 */
}

/* 小さな左上ラベル（添付イメージ風） */
#sidebar .typhoon-row .field-label{
  font-size: 12px;
  line-height: 1.1;
  color:#888;
  margin: 6px 4px 0;        /* 左に少し余白 */
  user-select:none;
}

/* 地図エリア */
#map {
  flex: 1;
  min-width: 0;
  position: relative;
  z-index: 1; /* サイドバーより背面 */
}

/* スライダーのラベル */
#time-row { margin-top: 8px; text-align: center; }
#time {
  width: 100%;      /* サイドバー幅に合わせて最大に伸ばす */
  box-sizing: border-box;
}
#time-label { margin-top: 4px; text-align: center; }

#label { white-space: nowrap; margin-left: 0; }

#typhoon-link { margin-top: 8px; }
#typhoon-link a { color: #0066cc; text-decoration: none; }
#typhoon-link a:hover { text-decoration: underline; }

.maplibregl-canvas { cursor: default; }
/* .maplibregl-canvas:active { cursor: grabbing; } */

/* 下線のみのセレクト */
.select-underline{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:transparent;
  border:none; border-bottom:2px solid #c7c7c7; border-radius:0;
  padding:2px 28px 2px 4px;
  width:100%;
  font:inherit; color:inherit; line-height:1.3; cursor:pointer;

  /* 右側のカスタム矢印 */
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23666' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'><polyline points='3,4 6,7 9,4'/></svg>");
  background-repeat:no-repeat;
  background-position:right 6px center;
  background-size:12px 12px;

  transition:border-color .15s ease, color .15s ease, background-color .15s ease;
}
.select-underline:hover{ border-bottom-color:#999; }
.select-underline:focus-visible{ outline:none; border-bottom-color:#1a73e8; }
.select-underline:disabled{ opacity:.6; cursor:not-allowed; }

/* アクセシビリティ対策 */
@media (forced-colors: active){
  .select-underline{ background-image:none; border:1px solid CanvasText; }
}
.select-underline::-ms-expand{ display:none; }

/* （任意）狭幅時は折り返しにする */
@media (max-width: 380px){
  #sidebar .typhoon-row{ flex-wrap:wrap; }
}

/* 初期ロード時のチラ見え防止（gustはデフォ非表示） */
#gust-colorbar,
#gust-colorbar-labels {
  display: none;
}

/* --- bottom sheet --- */
.sheet {
  position: absolute; left: 0; right: 0; bottom: 0;
  background: #fff; border-top: 1px solid #ddd;
  box-shadow: 0 -8px 20px rgba(0,0,0,.12);
  max-height: 40vh;
  transform: translateY(100%);
  transition: transform .25s ease;
  z-index: 500; /* サイドバーやマップオーバレイより上に */
}
.sheet.show { transform: translateY(0); }
.hidden { display: none; }

.sheet-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 8px 12px; font-weight: 600;
  border-bottom: 1px solid #eee;
}
.sheet-header button {
  border: none; background: transparent; font-size: 18px; cursor: pointer;
}
.sheet-meta { padding: 6px 12px; color: #666; font-size: 12px; }
.sheet-body { padding: 8px 12px; overflow: auto; }
.chart { height: 180px; width: 100%; }
.chart-block { margin-bottom: 12px; }
.chart-title { font-size: 12px; color: #444; margin-bottom: 4px; }
.chart-readout {
  font-size: 11px;
  color: #333;
  margin-bottom: 6px;
  font-variant-numeric: tabular-nums;
}

/* グラフコンテナ: 余白なし＆はみ出し禁止 */
#chart-precip, #chart-gust {
  position: relative;
  width: 100%;
  height: 180px;     /* 任意の高さ。あなたのUIに合わせて */
  padding: 0;
  margin: 0;
  border: 0;
  overflow: hidden;  /* これで微妙なスクロールバーを抑止 */
  line-height: 0;    /* inlineギャップ対策 */
  box-sizing: border-box;
}

.chart.empty::before {
  content: attr(data-placeholder);
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #666;
  background: #f6f7fc;
}
.chart.loading::after {
  content: attr(data-overlay);
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #fff;
  background: rgba(60,72,110,0.45);
  pointer-events: none;
}

#block-gust { display: none; }
#chart-none-message { display: none; font-size: 12px; color: #666; text-align: center; padding: 32px 0; }

/* uPlotのrootはブロックにして余白を出さない */
.uplot, .uplot canvas {
  display: block;
}

/* トラックポイントのポップアップ */
.track-popup .maplibregl-popup-content {
  padding: 8px 10px;
  font-size: 11px;
  color: #222;
  line-height: 1.5;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.track-popup .maplibregl-popup-tip { display: none; }
.track-tooltip { min-width: 180px; }
.track-tooltip .tt-line { display: flex; justify-content: space-between; gap: 8px; }
.track-tooltip .tt-label { font-weight: 600; color: #445; }
.track-tooltip .tt-value { text-align: right; color: #222; }

/* ====== レスポンシブ調整 ====== */
@media (max-width: 960px) {
  #app {
    flex-direction: column;
  }

  #sidebar {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid #ddd;
    max-height: 320px;
    padding: 12px 16px;
    transition: max-height .25s ease, padding .25s ease;
  }

  #sidebar.collapsed {
    width: 100%;
    padding: 0 16px;
    border-bottom: none;
    max-height: 0;
  }

  #sidebar-toggle {
    position: fixed;
    top: 12px;
    right: 12px;
    left: auto;
    z-index: 600;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }

  #sidebar.collapsed + #sidebar-toggle {
    right: 12px;
  }

  #map {
    flex: 1;
    min-height: 45vh;
  }

  .sheet {
    max-height: 55vh;
  }

  #sidebar .typhoon-row {
    flex-wrap: wrap;
  }
}

@media (max-width: 600px) {
  #sidebar {
    padding: 12px;
  }

  #sidebar.collapsed {
    padding: 0 12px;
  }

  #sidebar-title {
    font-size: 16px;
  }

  #sidebar h3 {
    font-size: 15px;
  }

  #map {
    min-height: 50vh;
  }

  .chart {
    height: 160px;
  }

  .sheet {
    max-height: 65vh;
  }
}

/* クリック位置マーカー */
.click-marker {
  position: relative;
  width: 6px;
  height: 6px;
  border: 2px solid #fff;     /* 見やすい白縁 */
  border-radius: 50%;
  background: #1f77b4;        /* 濃い青 */
  box-shadow: 0 0 0 2px rgba(31,119,180,.35); /* 外側にうっすら */
}

/* クリック時の波紋 */
.click-marker.ping::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 10px;
  height: 10px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  box-shadow: 0 0 0 0 rgba(31,119,180,.55);
  animation: clickPing 1.4s ease-out infinite; /* ← 無限ループ */
  pointer-events: none;
}

@keyframes clickPing {
  0%   { box-shadow: 0 0 0 0 rgba(31,119,180,.55); opacity: 1; }
  100% { box-shadow: 0 0 0 14px rgba(31,119,180,0); opacity: 0; }
}
